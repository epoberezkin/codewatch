# Concept & Entity Index

Comprehensive index of all concepts and entities in the CodeWatch codebase, with cross-references to product docs, spec docs, source files, and tests.

---

## Section 1: Concepts

| # | Concept | Description | Product Docs | Spec Docs | Source Files | Tests |
|---|---------|-------------|-------------|-----------|-------------|-------|
| 1 | **Project Creation** | Creating a project from GitHub repos: URL parsing, org/repo fetching, deduplication, branch setup | [flows/project-creation.md](flows/project-creation.md), [views/home.md](views/home.md) | [spec/api.md](../spec/api.md) (POST /api/projects), [spec/services/github.md](../spec/services/github.md), [spec/services/git.md](../spec/services/git.md) | `src/server/routes/api.ts`, `src/server/services/github.ts`, `src/server/services/git.ts`, `src/client/home.ts` | `test/api/projects.test.ts`, `test/api/journey.test.ts` |
| 2 | **Ownership Verification** | GitHub-based ownership checks (personal account match, org admin, repo admin fallback) with 15-min cache | [flows/authentication.md](flows/authentication.md), [README.md](README.md) (Access Control Model) | [spec/services/ownership.md](../spec/services/ownership.md), [spec/services/github.md](../spec/services/github.md), [spec/auth.md](../spec/auth.md) | `src/server/services/ownership.ts`, `src/server/services/github.ts`, `src/server/routes/api.ts` | `test/api/ownership.test.ts`, `test/services/github-ownership.test.ts` |
| 3 | **Cost Estimation** | Rough (character-based) and precise (Anthropic count_tokens API) token counting, per-level cost calculation | [views/estimate.md](views/estimate.md), [flows/audit-lifecycle.md](flows/audit-lifecycle.md) | [spec/api.md](../spec/api.md) (POST /api/estimate, POST /api/estimate/precise), [spec/services/tokens.md](../spec/services/tokens.md) | `src/server/routes/api.ts`, `src/server/services/tokens.ts`, `src/server/services/git.ts`, `src/client/estimate.ts` | `test/api/estimate.test.ts` |
| 4 | **Component Analysis** | Agentic multi-turn Claude analysis: repo exploration, component identification, security profiling, dependency detection | [flows/component-analysis.md](flows/component-analysis.md), [views/estimate.md](views/estimate.md) | [spec/services/componentAnalysis.md](../spec/services/componentAnalysis.md), [spec/api.md](../spec/api.md) (POST /api/projects/:id/analyze-components) | `src/server/services/componentAnalysis.ts`, `src/server/services/claude.ts`, `src/server/services/prompts.ts`, `src/server/routes/api.ts`, `src/client/estimate.ts` | `test/services/componentAnalysis.test.ts` |
| 5 | **Audit Planning** | Security grep scanning, Claude-driven file ranking, token-budget file selection | [flows/audit-lifecycle.md](flows/audit-lifecycle.md) | [spec/services/planning.md](../spec/services/planning.md), [spec/services/tokens.md](../spec/services/tokens.md) | `src/server/services/planning.ts`, `src/server/services/tokens.ts`, `src/server/services/claude.ts`, `src/server/services/prompts.ts` | `test/services/planning.test.ts` |
| 6 | **Audit Execution** | Batch file analysis, findings generation, status tracking (pending through completed) | [flows/audit-lifecycle.md](flows/audit-lifecycle.md), [views/audit.md](views/audit.md) | [spec/services/audit.md](../spec/services/audit.md), [spec/api.md](../spec/api.md) (POST /api/audit/start, GET /api/audit/:id) | `src/server/services/audit.ts`, `src/server/services/claude.ts`, `src/server/services/prompts.ts`, `src/server/routes/api.ts`, `src/client/audit.ts` | `test/api/audit.test.ts`, `test/api/journey.test.ts` |
| 7 | **Incremental Audits** | Diff-based re-analysis against a base audit, finding inheritance via fingerprints, rename tracking | [flows/audit-lifecycle.md](flows/audit-lifecycle.md) | [spec/services/audit.md](../spec/services/audit.md), [spec/services/git.md](../spec/services/git.md) | `src/server/services/audit.ts`, `src/server/services/git.ts`, `src/server/routes/api.ts` | `test/api/audit.test.ts` |
| 8 | **Classification** | Project categorization (library, cli_tool, etc.), threat model generation/repo detection | [flows/audit-lifecycle.md](flows/audit-lifecycle.md), [views/project.md](views/project.md) | [spec/services/audit.md](../spec/services/audit.md), [spec/database.md](../spec/database.md) (projects.category, projects.threat_model) | `src/server/services/audit.ts`, `src/server/services/claude.ts`, `src/server/services/prompts.ts`, `src/server/routes/api.ts` | `test/api/audit.test.ts`, `test/api/journey.test.ts` |
| 9 | **Report Access Control** | Three-tier access: owner (full), requester (partial redaction), public (summary only) | [views/report.md](views/report.md), [README.md](README.md) (Access Control Model) | [spec/api.md](../spec/api.md) (GET /api/audit/:id/report, resolveAccessTier) | `src/server/routes/api.ts`, `src/client/report.ts` | `test/api/audit.test.ts`, `test/api/ownership.test.ts`, `test/api/disclosure.test.ts` |
| 10 | **Report Redaction** | Severity-based finding visibility: medium/high/critical redacted for requesters, all redacted for public | [views/report.md](views/report.md), [flows/responsible-disclosure.md](flows/responsible-disclosure.md) | [spec/api.md](../spec/api.md) (GET /api/audit/:id/report, GET /api/audit/:id/findings) | `src/server/routes/api.ts`, `src/client/report.ts` | `test/api/audit.test.ts`, `test/api/disclosure.test.ts`, `test/api/ownership.test.ts` |
| 11 | **Responsible Disclosure** | Owner notification via GitHub issue, severity-based auto-publish timer (3/6 months) | [flows/responsible-disclosure.md](flows/responsible-disclosure.md), [views/report.md](views/report.md) | [spec/api.md](../spec/api.md) (POST /api/audit/:id/notify-owner), [spec/services/github.md](../spec/services/github.md) | `src/server/routes/api.ts`, `src/server/services/github.ts`, `src/client/report.ts` | `test/api/disclosure.test.ts` |
| 12 | **Finding Management** | Status tracking (open/fixed/false_positive/accepted/wont_fix), severity/CWE/CVSS metadata, owner-only mutations | [views/report.md](views/report.md) | [spec/api.md](../spec/api.md) (PATCH /api/findings/:id/status, GET /api/audit/:id/findings), [spec/database.md](../spec/database.md) (audit_findings) | `src/server/routes/api.ts`, `src/client/report.ts` | `test/api/audit.test.ts`, `test/api/ownership.test.ts` |
| 13 | **Comments** | Audit-level comment threads by owners and requesters, optional finding linkage | [views/report.md](views/report.md) | [spec/api.md](../spec/api.md) (POST /api/audit/:id/comments, GET /api/audit/:id/comments), [spec/database.md](../spec/database.md) (audit_comments) | `src/server/routes/api.ts`, `src/client/report.ts` | `test/api/audit.test.ts` |
| 14 | **Component Selection** | Scoped audits on user-selected components, component-scoped cost estimation | [views/estimate.md](views/estimate.md), [flows/audit-lifecycle.md](flows/audit-lifecycle.md) | [spec/api.md](../spec/api.md) (POST /api/estimate/components, POST /api/audit/start with componentIds), [spec/services/tokens.md](../spec/services/tokens.md) | `src/server/routes/api.ts`, `src/server/services/tokens.ts`, `src/client/estimate.ts` | `test/api/component-selection.test.ts` |
| 15 | **Supply Chain** | Dependency detection per ecosystem, source URL resolution, linking to existing CodeWatch projects | [flows/component-analysis.md](flows/component-analysis.md), [views/project.md](views/project.md), [views/report.md](views/report.md) | [spec/api.md](../spec/api.md) (POST /api/dependencies/:id/link), [spec/services/componentAnalysis.md](../spec/services/componentAnalysis.md), [spec/database.md](../spec/database.md) (project_dependencies) | `src/server/services/componentAnalysis.ts`, `src/server/routes/api.ts`, `src/client/project.ts`, `src/client/report.ts` | `test/api/component-selection.test.ts` |
| 16 | **Authentication** | GitHub OAuth with `read:org` scope, session-based auth, 14-day expiry, cookie management | [flows/authentication.md](flows/authentication.md), [views/home.md](views/home.md) | [spec/auth.md](../spec/auth.md), [spec/services/github.md](../spec/services/github.md), [spec/database.md](../spec/database.md) (users, sessions) | `src/server/routes/auth.ts`, `src/server/services/github.ts`, `src/server/routes/api.ts`, `src/client/common.ts` | `test/api/auth.test.ts` |
| 17 | **Pre-launch Gate** | Password protection for all routes (bypasses health check, gate page, and static asset extensions) via signed cookie | [views/gate.md](views/gate.md) | [spec/auth.md](../spec/auth.md), [spec/config.md](../spec/config.md) | `src/server/middleware/gate.ts`, `src/server/app.ts`, `src/server/config.ts` | `test/api/gate.test.ts` |
| 18 | **Branch Selection** | Per-project branch overrides for each repository, NULL = use default branch | [flows/project-creation.md](flows/project-creation.md), [views/project.md](views/project.md) | [spec/api.md](../spec/api.md) (PUT /api/projects/:id/branches), [spec/database.md](../spec/database.md) (project_repos.branch) | `src/server/routes/api.ts`, `src/client/project.ts` | `[UNTESTED]` |
| 19 | **Project Browsing** | Filtering by category/severity, search via ILIKE, "My Projects" toggle, visibility-based listing | [views/projects.md](views/projects.md) | [spec/api.md](../spec/api.md) (GET /api/projects/browse), [spec/client/projects.md](../spec/client/projects.md) | `src/server/routes/api.ts`, `src/client/projects.ts` | `test/api/project-pages.test.ts` |
| 20 | **Audit Synthesis** | Executive summary, security posture, severity aggregation, threat model, component breakdown generation | [flows/audit-lifecycle.md](flows/audit-lifecycle.md), [views/report.md](views/report.md) | [spec/services/audit.md](../spec/services/audit.md), [spec/services/prompts.md](../spec/services/prompts.md) | `src/server/services/audit.ts`, `src/server/services/claude.ts`, `src/server/services/prompts.ts`, `src/server/routes/api.ts`, `src/client/report.ts` | `test/api/audit.test.ts`, `test/api/journey.test.ts` |

---

## Section 2: Entities

| # | Entity | DB Table | Created By | Read By | Mutated By | Deleted By |
|---|--------|----------|-----------|---------|-----------|-----------|
| 1 | **User** | `users` | `routes/auth.ts` via GitHub OAuth callback (`INSERT ON CONFLICT UPDATE`) | `routes/api.ts` `getSessionInfo()`, `GET /api/projects/browse`, `GET /api/projects/:id`, `GET /api/audit/:id/comments` | `routes/auth.ts` OAuth callback (`last_seen_at`, `github_username`, `avatar_url` on re-login) | Not deleted (no endpoint) |
| 2 | **Session** | `sessions` | `routes/auth.ts` OAuth callback (`INSERT INTO sessions`) | `routes/api.ts` `getSessionInfo()` (every authenticated request), `routes/auth.ts` `GET /auth/me` | Not mutated | `routes/auth.ts` `POST /auth/logout` (`DELETE FROM sessions WHERE id`) |
| 3 | **Project** | `projects` | `POST /api/projects` via `routes/api.ts` | `GET /api/projects/:id`, `GET /api/projects/browse`, `GET /api/project/:id/audits`, `runAudit()` | `runAudit()` classification phase (sets `category`, `description`, `threat_model`, etc.), `POST /api/projects/:id/analyze-components` (sets `component_analysis_id`), `POST /api/estimate` (sets `total_files`, `total_tokens`) | `DELETE /api/projects/:id` (cascading transaction) |
| 4 | **Repository** | `repositories` | `POST /api/projects` via UPSERT (`INSERT ON CONFLICT UPDATE`) | `GET /api/projects/:id`, `POST /api/estimate`, `GET /api/audit/:id/report`, `GET /api/audit/:id/findings` | `POST /api/estimate` (updates `total_files`, `total_tokens`, `last_cloned_at`, `default_branch`) | Not deleted directly (orphaned repos persist) |
| 5 | **Audit** | `audits` | `POST /api/audit/start` (`INSERT INTO audits`) | `GET /api/audit/:id`, `GET /api/audit/:id/report`, `GET /api/project/:id/audits`, `GET /api/reports` | `runAudit()` (status transitions, `files_analyzed`, `progress_detail`, `report_summary`, `max_severity`, `actual_cost_usd`, `started_at`, `completed_at`), `POST /api/audit/:id/publish` (`is_public`), `POST /api/audit/:id/unpublish` (`is_public`, `publishable_after`), `POST /api/audit/:id/notify-owner` (`owner_notified`, `publishable_after`) | `DELETE /api/audit/:id` (requester only, cascading transaction), `DELETE /api/projects/:id` (cascade) |
| 6 | **Finding** | `audit_findings` | `runAudit()` analysis phase (`INSERT INTO audit_findings`) | `GET /api/audit/:id/report`, `GET /api/audit/:id/findings`, `GET /api/projects/:id` (severity counts) | `PATCH /api/findings/:id/status` (owner-only, changes `status`), `runAudit()` incremental phase (sets `resolved_in_audit_id` on inherited findings) | `DELETE /api/audit/:id` (cascade), `DELETE /api/projects/:id` (cascade) |
| 7 | **Comment** | `audit_comments` | `POST /api/audit/:id/comments` (`INSERT INTO audit_comments`) | `GET /api/audit/:id/comments` | Not mutated (no edit endpoint) | `DELETE /api/audit/:id` (cascade), `DELETE /api/projects/:id` (cascade) |
| 8 | **Component** | `components` | `runComponentAnalysis()` in `services/componentAnalysis.ts` (`INSERT INTO components`) | `GET /api/projects/:id/components`, `GET /api/projects/:id`, `GET /api/audit/:id/report` (component breakdown) | Not mutated after creation | `DELETE /api/projects/:id` (cascade) |
| 9 | **Component Analysis** | `component_analyses` | `POST /api/projects/:id/analyze-components` (`INSERT INTO component_analyses`) | `GET /api/projects/:id/component-analysis/:analysisId` | `runComponentAnalysis()` (status transitions, `turns_used`, token counts, `cost_usd`, `completed_at`) | `DELETE /api/projects/:id` (cascade) |
| 10 | **Dependency** | `project_dependencies` | `runComponentAnalysis()` in `services/componentAnalysis.ts` (`INSERT INTO project_dependencies`) | `GET /api/projects/:id`, `GET /api/audit/:id/report` | `POST /api/dependencies/:id/link` (sets `linked_project_id`) | `DELETE /api/projects/:id` (cascade) |
| 11 | **Ownership Cache** | `ownership_cache` | `resolveOwnership()` in `services/ownership.ts` (`INSERT ON CONFLICT UPDATE`) | `resolveOwnership()` (checks cache before GitHub API call) | `resolveOwnership()` (UPSERT updates `is_owner`, `role`, `checked_at`, `expires_at` on re-check) | `invalidateOwnershipCache()` in `services/ownership.ts` (on re-authentication, `DELETE FROM ownership_cache WHERE user_id`) |
| 12 | **Audit Commit** | `audit_commits` | `runAudit()` cloning phase (`INSERT INTO audit_commits`) | `GET /api/audit/:id`, `GET /api/audit/:id/report`, `GET /api/project/:id/audits` | Not mutated | `DELETE /api/audit/:id` (cascade), `DELETE /api/projects/:id` (cascade) |
| 13 | **Audit Component** | `audit_components` | `runAudit()` planning phase (`INSERT INTO audit_components`) | `GET /api/audit/:id/report` (component breakdown with `tokens_analyzed`, `findings_count`) | `runAudit()` (updates `tokens_analyzed`, `findings_count` during analysis) | `DELETE /api/audit/:id` (cascade), `DELETE /api/projects/:id` (cascade) |
| 14 | **Model Pricing** | `model_pricing` | SQL migration `001_initial.sql` (seed data for Opus/Sonnet/Haiku) | `POST /api/estimate` and `POST /api/estimate/precise` via `estimateCosts()` in `services/tokens.ts` | Not mutated by application code | Not deleted by application code |
| 15 | **Watch** | `project_watches` | Not yet created by any endpoint (schema-ready, post-MVP) | Not yet read by any endpoint | Not yet mutated by any endpoint | Not yet deleted by any endpoint `[UNTESTED]` |
